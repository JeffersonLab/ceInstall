#%Module

#conflict .qt

# Environment

set version system


# set QTSYSTEM based on uname
if { [uname sysname] == "Linux" } {
	set QTSYSTEM gcc_64
} elseif { [uname sysname] == "Darwin" } {
	set QTSYSTEM clang_64
} else {
	puts stderr "Unknown system type"
	exit 1
}

set base_dir $env(SIM_HOME)/$env(OSRELEASE)/$env(SIM_SUB_DIR)/$env(SIM_VERSION)

set dir $base_dir/qt/${version}/${QTSYSTEM}

prepend-path LD_LIBRARY_PATH $dir/lib
if { [uname sysname] == "Darwin" } {
	prepend-path DYLD_LIBRARY_PATH $dir/lib
}

prepend-path PKG_CONFIG_PATH $dir/lib/pkgconfig
prepend-path PATH $dir/bin

setenv QT_VERSION $version
setenv QTDIR $dir

proc ModulesTest { } {
	
	set var QT
	set installation_dir  [ getenv QTDIR ]/lib
	set retcode 1
	
	# exit if is_loaded is empty
	if { [module-info loaded physlibs] == "" } {
		puts stderr "physlibs is not loaded. Use module load physlibs to load it."
		puts stderr ""
		return 0
	}
	
	puts stderr ""
	if { [file isdirectory $installation_dir ] } {
		puts stderr " Y $var $installation_dir"
	} else {
		puts stderr " N $var $installation_dir"
		set retcode 0
	}
	
	return $retcode
}

